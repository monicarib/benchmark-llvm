//#include <stdlib.h> // If malloc() is used
#include <math.h>
#include "dt.h"

#define  ITERATIONS 500 // Original value 131072
#define  size 128 // 256 // Original value 2048

// For size = 128
double expectedResult[size] = {
-0.692896, 0.232359, 0.943984, 0.787715, -0.092776, -0.887969, -0.866767, -0.048664, 0.814181, 0.928471, 0.189129, -0.724097, -0.971592, -0.325810, 0.619521, 0.995267, 0.455969, -0.502544, -0.999021, -0.577002, 0.375510, 0.982780, 0.686487, -0.240959, -0.946868, -0.782231, 0.101586, 0.892005, 0.862319, 0.039821, -0.819288, -0.925148, -0.180430, 0.730174, 0.969459, 0.317429, -0.626445, -0.994368, -0.448074, 0.510177, 0.999373, 0.569750, -0.383699, -0.984377, -0.680024, 0.249540, 0.949678, 0.776686, -0.110387, -0.895971, -0.857803, -0.030975, 0.824331, 0.921751, 0.171717, -0.736193, -0.967251, -0.309023, 0.633319, 0.993390, 0.440143, -0.517770, -0.999648, -0.562454, 0.391857, 0.985897, 0.673507, -0.258102, -0.952413, -0.771080, 0.119180, 0.899867, 0.853220, 0.022127, -0.829310, -0.918283, -0.162991, 0.742154, 0.964966, 0.300593, -0.640144, -0.992336, -0.432178, 0.525322, 0.999843, 0.555113, -0.399985, -0.987339, -0.666938, 0.266643, 0.955074, 0.765414, -0.127964, -0.903692, -0.848570, -0.013277, 0.834223, 0.914742, 0.154251, -0.748058, -0.962606, -0.292139, 0.646919, 0.991203, 0.424179, -0.532833, -0.999961, -0.547729, 0.408082, 0.988705, 0.660317, -0.275163, -0.957660, -0.759688, 0.136737, 0.907447, 0.843854, 0.004426, -0.839072, -0.911130, -0.145500, 0.753902, 0.960170, 0.283662, -0.653644, -0.989993, -0.416147, 0.540302
};
/* 
// For size = 256
double expectedResult[size] = {
-0.039791, -0.862304, -0.892019, -0.101616, 0.782212, 0.946878, 0.240988, -0.686465, -0.982785, -0.375538, 0.576978, 0.999022, 0.502570, -0.455942, -0.995264, -0.619544, 0.325781, 0.971585, 0.724118, -0.189100, -0.928460, -0.814198, 0.048634, 0.866752, 0.887983, 0.092806, -0.787696, -0.943994, -0.232388, 0.692874, 0.981112, 0.367319, -0.584184, -0.998592, -0.494898, 0.463802, 0.996085, 0.612572, -0.334137, -0.973642, -0.717985, 0.197784, 0.931712, 0.809028, -0.057472, -0.871133, -0.883877, -0.083989, 0.793118, 0.941037, 0.223770, -0.699229, -0.979361, -0.359072, 0.591345, 0.998083, 0.487188, -0.471626, -0.996829, -0.605552, 0.342467, 0.975623, 0.711796, -0.206453, -0.934890, -0.803793, 0.066307, 0.875445, 0.879703, 0.075166, -0.798478, -0.938005, -0.215135, 0.705530, 0.977533, 0.350797, -0.598460, -0.997496, -0.479439, 0.479412, 0.997494, 0.598484, -0.350769, -0.977527, -0.705551, 0.215105, 0.937995, 0.798496, -0.075136, -0.879689, -0.875459, -0.066337, 0.803776, 0.934901, 0.206482, -0.711775, -0.975629, -0.342495, 0.605528, 0.996831, 0.471652, -0.487161, -0.998081, -0.591370, 0.359044, 0.979355, 0.699251, -0.223741, -0.941026, -0.793136, 0.083959, 0.883864, 0.871148, 0.057503, -0.809010, -0.931722, -0.197814, 0.717964, 0.973649, 0.334165, -0.612548, -0.996088, -0.463829, 0.494872, 0.998590, 0.584209, -0.367291, -0.981106, -0.692896, 0.232359, 0.943984, 0.787715, -0.092776, -0.887969, -0.866767, -0.048664, 0.814181, 0.928472, 0.189129, -0.724097, -0.971592, -0.325810, 0.619521, 0.995267, 0.455969, -0.502544, -0.999021, -0.577002, 0.375510, 0.982780, 0.686487, -0.240959, -0.946868, -0.782231, 0.101586, 0.892005, 0.862319, 0.039821, -0.819288, -0.925148, -0.180430, 0.730174, 0.969460, 0.317429, -0.626444, -0.994367, -0.448074, 0.510177, 0.999373, 0.569750, -0.383698, -0.984377, -0.680024, 0.249540, 0.949678, 0.776686, -0.110387, -0.895971, -0.857803, -0.030975, 0.824331, 0.921751, 0.171717, -0.736193, -0.967251, -0.309023, 0.633319, 0.993391, 0.440143, -0.517770, -0.999647, -0.562454, 0.391857, 0.985897, 0.673507, -0.258102, -0.952413, -0.771080, 0.119180, 0.899867, 0.853220, 0.022127, -0.829310, -0.918283, -0.162991, 0.742154, 0.964966, 0.300593, -0.640144, -0.992335, -0.432178, 0.525322, 0.999844, 0.555113, -0.399985, -0.987339, -0.666938, 0.266643, 0.955074, 0.765414, -0.127964, -0.903692, -0.848570, -0.013277, 0.834224, 0.914743, 0.154251, -0.748058, -0.962606, -0.292139, 0.646919, 0.991203, 0.424179, -0.532833, -0.999961, -0.547729, 0.408082, 0.988705, 0.660317, -0.275163, -0.957659, -0.759688, 0.136737, 0.907447, 0.843854, 0.004426, -0.839072, -0.911130, -0.145500, 0.753902, 0.960170, 0.283662, -0.653644, -0.989992, -0.416147, 0.540302
};
*/

int main() {
  double	dvec1[size], dvec2[size];
  long i;

/*
  // With better alias analysis of posix_memalign, we'd avoid reloading dvec1/dvec2 each time through the loop.
  // However, this command din't work for leon3 architecture and it was changed to malloc()
  dvec1 = (double *) malloc(size * sizeof(double)); //posix_memalign((void**) &dvec1, 16, size * sizeof(double));
  dvec2 = (double *) malloc(size * sizeof(double)); //posix_memalign((void**) &dvec2, 16, size * sizeof(double));
*/

  //For sin(), cos() in <math.h> we need -lm option explicitly. 
  //gcc dt_main.c dt.c -o application -lm

  for(i = 0; i < size; i++) {
          dvec1[i] = 1.0000001 * cos((double)(size - i));
          dvec2[i] = 1.0  + 0.0000000001 * sin((double)i);
  }

  dt(dvec1, dvec2, ITERATIONS, size);
  
//  for(i = 0; i < size; i++) printf("%.6lf, ", dvec1[i]); // Debug
  
  for (i = 0; i < size; i++){
      if (dvec1[i] - expectedResult[i] > 0.0000009) {
         return 1;
	  }
  }
  
  return 10;
}
